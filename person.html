<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/style.css">
  <title>תיקייה</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script defer src="/assets/app.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <nav class="nav" aria-label="תפריט">
        <a href="/">דף הבית</a>
        <a href="/staff.html">צוערים</a>
        <a class="active" href="#" id="personNav">אישי</a>
      </nav>
      <span class="badge" id="saveMode">שמירה: בדפדפן</span>
    </div>
  </div>

  <main class="container">
    <div class="card">
      <h1 class="h1" id="personTitle">טוען…</h1>
      <p class="small">כל שבוע מכיל שני מסמכים: (1) דף תצפית + המשך (2) דף רפלקציה.</p>
      <div class="week-grid" id="weeks"></div>
    </div>
  </main>

  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-label="מסמך">
    <div class="modal">
      <div class="modal-header">
        <div class="title" id="modalTitle">מסמך</div>
        <div style="display:flex; gap:8px; align-items:center;">
          <span class="badge" id="saveState">לא נשמר</span>
          <button class="btn secondary" type="button" id="closeModalBtn">סגירה</button>
        </div>
      </div>

      <form class="form" id="docForm"></form>

      <div style="display:flex; gap:10px; justify-content:flex-end; padding:12px 0 4px;">
        <button class="btn secondary" type="button" id="reloadBtn">טען גרסה שמורה</button>
        <button class="btn secondary" type="button" id="pdfBtn">ייצוא PDF</button>
        <button class="btn primary" type="button" id="saveBtn">שמירה</button>
      </div>
      <div class="small" style="padding-bottom:6px;">שמירה כאן נשמרת בענן משותף (זמין מכל מכשיר). אם תפתח ממכשיר אחר – זה לא יופיע.</div>
    </div>
  </div>

<div style="position:fixed;bottom:14px;left:14px;z-index:9999;display:flex;gap:10px;align-items:center;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;box-shadow:0 8px 18px rgba(0,0,0,.12);">
  <button id="loginBtn" type="button" style="border:0;border-radius:10px;padding:10px 12px;background:#667eea;color:#fff;font-weight:700;cursor:pointer;">התחברות</button>
  <button id="logoutBtn" type="button" style="border:1px solid #ddd;border-radius:10px;padding:10px 12px;background:#fff;font-weight:700;cursor:pointer;">התנתקות</button>
  <span id="who" style="font-weight:700;color:#333;">לא מחובר</span>
</div>

<script>
  function refreshUserLabel(){
    const u = window.netlifyIdentity && window.netlifyIdentity.currentUser && window.netlifyIdentity.currentUser();
    const label = document.getElementById("who");
    if(!label) return;
    label.textContent = u ? ("מחובר: " + ((u.user_metadata && u.user_metadata.full_name) || u.email)) : "לא מחובר";
  }

  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", refreshUserLabel);
    window.netlifyIdentity.on("login", function(){ refreshUserLabel(); window.netlifyIdentity.close(); });
    window.netlifyIdentity.on("logout", refreshUserLabel);
    window.netlifyIdentity.init();
  }

  document.getElementById("loginBtn").addEventListener("click", function(){ window.netlifyIdentity && window.netlifyIdentity.open(); });
  document.getElementById("logoutBtn").addEventListener("click", function(){ window.netlifyIdentity && window.netlifyIdentity.logout(); });
</script>

</body>
</html>
